Code is mostly ported from golang source
See time/format.go
